<?xml version="1.0" encoding="UTF-8" ?>
<!--
    This install XML defines additional database tables for the Mindscape Feed
    plugin.  A new table is introduced to support the simple friends system
    requested by the user.  Each record in the table represents a relationship
    between two users and stores its status (pending or accepted).  The
    combination of userid and friendid is unique to prevent duplicate entries.

    To install this table, place this file under the plugin's db/ directory.
    The Moodle XMLDB engine will process it when the plugin is installed.
-->
<XMLDB PATH="local/mindscape_feed/db" VERSION="2025110100" COMMENT="Install tables for Mindscape Feed" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="../../lib/xmldb/xmldb.xsd">
    <TABLES>
        <TABLE NAME="local_mindscape_friends" COMMENT="Friend relationships for Mindscape Feed">
            <FIELD NAME="id" TYPE="int" LENGTH="10" UNSIGNED="true" NOTNULL="true" SEQUENCE="true"/>
            <FIELD NAME="userid" TYPE="int" LENGTH="10" UNSIGNED="true" NOTNULL="true" COMMENT="The user who initiated the friendship"/>
            <FIELD NAME="friendid" TYPE="int" LENGTH="10" UNSIGNED="true" NOTNULL="true" COMMENT="The other user in the relationship"/>
            <FIELD NAME="status" TYPE="char" LENGTH="10" NOTNULL="true" DEFAULT="pending" COMMENT="pending or accepted"/>
            <FIELD NAME="timecreated" TYPE="int" LENGTH="10" UNSIGNED="true" NOTNULL="true" DEFAULT="0" COMMENT="Unix timestamp of creation"/>
            <KEY NAME="primary" TYPE="primary" FIELDS="id"/>
            <KEY NAME="user_friend_unique" TYPE="unique" FIELDS="userid, friendid"/>
        </TABLE>
        <!-- Table to store dislikes on posts.  Each record represents a single
             dislike from a user on a post.  The combination of postid and
             userid is unique to ensure a user can only dislike a post once.
             If you remove dislikes on an upgrade, the table can be safely
             dropped and recreated. -->
        <TABLE NAME="local_mindscape_dislikes" COMMENT="Dislikes for posts in Mindscape Feed">
            <FIELD NAME="id" TYPE="int" LENGTH="10" UNSIGNED="true" NOTNULL="true" SEQUENCE="true"/>
            <FIELD NAME="postid" TYPE="int" LENGTH="10" UNSIGNED="true" NOTNULL="true" COMMENT="ID of the post that was disliked"/>
            <FIELD NAME="userid" TYPE="int" LENGTH="10" UNSIGNED="true" NOTNULL="true" COMMENT="ID of the user who disliked the post"/>
            <FIELD NAME="timecreated" TYPE="int" LENGTH="10" UNSIGNED="true" NOTNULL="true" DEFAULT="0" COMMENT="Timestamp when the dislike was created"/>
            <KEY NAME="primary" TYPE="primary" FIELDS="id"/>
            <KEY NAME="post_user_unique" TYPE="unique" FIELDS="postid, userid"/>
        </TABLE>
    </TABLES>
</XMLDB>